language: php
matrix:
  fast_finish: true
  include:
    - php: "7.0"
      env: SKIP_INSTALL=0
    - php: "7.1"
      env: SKIP_INSTALL=0
    - php: "7.2"
      env: SKIP_INSTALL=1
    - php: "7.3"
      env: SKIP_INSTALL=1
    - php: "nightly"
      env: SKIP_INSTALL=1
    - php: "master"
      env: SKIP_INSTALL=1
  allow_failures:
    - php: "nightly"
    - php: "master"

os:
 - linux

before_script:
 - git clone git://github.com/jedisct1/libsodium.git
 - cd libsodium
 - ./autogen.sh
 - ./configure --disable-dependency-tracking
 - make
 - sudo make install
 - sudo /sbin/ldconfig
 - cd ..
 - rm -fr libsodium

script:
 - if [[ $SKIP_INSTALL -eq 0 ]]; then phpize; endif
 - if [[ $SKIP_INSTALL -eq 0 ]]; then ./configure --with-sodium; endif
 - if [[ $SKIP_INSTALL -eq 0 ]]; then make clean; endif
 - if [[ $SKIP_INSTALL -eq 0 ]]; then make; endif
 - env NO_INTERACTION=1 make test
